import{j as e,F as j,r as i,C as v,G as S,c as o,S as B,t as D,E as H,I as _,f as O,J as $,v as P,u as V,w as J,T,K as M,m as U}from"./vendor.6b141815.js";import{i as K,I as x,f as X}from"./index.84b58e98.js";const R=({text:t,highlight:c})=>{if(!c)return e(j,{children:t});const a=t.split(new RegExp(`(${c})`,"gi"));return e("span",{children:a.map((l,p)=>e("span",{className:l.toLowerCase()===c.toLowerCase()?"highlight":"",children:l},p))})};window.HELP_IMPROVE_VIDEOJS=!1;const L=[.7,1,1.5,2],g={},z=t=>{var C,E,w,N;const c=i.exports.useRef(null),a=i.exports.useRef(null),[l,p]=i.exports.useState(!1),[d,m]=i.exports.useState(""),y=i.exports.useCallback(async()=>{if(t.replay&&!g[t.replay.id]){p(!0);const{id:s,roomId:n,startAt:u,endAt:h}=t.replay,b=await K({roomId:n,startTime:u,endTime:h||v(u).add(3,"hour").toJSON()});g[s]=b,p(!1)}},[(C=t.replay)==null?void 0:C.id]);i.exports.useEffect(()=>{y()},[y]);const f=i.exports.useCallback(()=>{var s,n;if(!!((s=t.replay)!=null&&s.choseUrl)){if(a.current)a.current.src((n=t.replay)==null?void 0:n.choseUrl),a.current.playbackRates(L);else if(c.current){const u={playbackRates:L},h=window.videojs(c.current,u,function(){});a.current=h}}},[(E=t.replay)==null?void 0:E.choseUrl,c.current]);i.exports.useEffect(()=>{f()},[f]);const k=i.exports.useCallback(()=>{const s=a.current;s&&s.reset()},[a.current]);i.exports.useEffect(()=>()=>{k()},[a]);const A=s=>{var n,u;if(((n=t.replay)==null?void 0:n.startAt)&&a.current){const h=v(s).diff(v((u=t.replay)==null?void 0:u.startAt),"second");a.current.currentTime(h)}},r=g[((w=t.replay)==null?void 0:w.id)||""],I=S(s=>{const n=s.target.value.trim();m(n)},300),F=()=>d?$(r==null?void 0:r.roomActionList,s=>{var n;return((n=s.userName)==null?void 0:n.toLowerCase().includes(d))||s.description.replace(/(TEXT:|CODE:)/,"").toLowerCase().includes(d)}):r==null?void 0:r.roomActionList;return o("div",{className:"video-replay-wrap",children:[e("div",{className:"replay-box",children:e("div",{"data-vjs-player":!0,style:{width:"100%",height:"100%"},children:o("video",{controls:!0,playsInline:!0,ref:c,id:"replay-video",className:"video-js vjs-big-play-centered",preload:"auto",children:[e("source",{src:(N=t.replay)==null?void 0:N.choseUrl,type:"video/mp4"}),o("p",{className:"vjs-no-js",children:["To view this video please enable JavaScript, and consider upgrading to a web browser that",e("a",{href:"https://videojs.com/html5-video-support/",target:"_blank",children:"supports HTML5 video"})]})]})})}),o("div",{className:"replay-chat-history",children:[o("header",{children:[e("h3",{children:"\u804A\u5929\u8BB0\u5F55 "}),(r==null?void 0:r.totalNum)&&o("span",{className:"chat-total",children:["\u5171",e("span",{children:r==null?void 0:r.totalNum}),"\u6761"]})]}),e("main",{className:`${l?"chat-loading":""}`,children:l?e(B,{spinning:l}):D(r==null?void 0:r.roomActionList)?e(H,{description:"\u6682\u65E0\u6570\u636E"}):o(j,{children:[e(_,{allowClear:!0,className:"chat-text-search",width:"100%",placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5173\u952E\u5B57!",suffix:e(x,{symbol:"icon-search"}),onChange:I,onPressEnter:s=>{const n=s.currentTarget.value.trim();m(n)}}),O(F(),s=>o("div",{className:"chat-item",children:[o("span",{className:"chator",children:[e(R,{text:s.userName,highlight:d}),e("span",{className:"chat-time",children:v(s.actionTime).format("HH:mm:ss")})]}),e("pre",{onClick:()=>A(s.actionTime),children:e(R,{text:s.description.replace(/(TEXT:|CODE:)/,""),highlight:d})})]},s.id))]})})]})]})};const Q=()=>{const{id:t,replayId:c}=P(),[a,l]=i.exports.useState(),p=V(),d=i.exports.useCallback(async()=>{const m=await X(t),y=J(m,({id:f})=>`${f}`===c);l(y)},[t]);return i.exports.useEffect(()=>{d()},[d]),o("div",{className:"video-replay-modal",children:[o("header",{children:[e("div",{className:"title",children:a==null?void 0:a.className}),o("div",{className:"actions",children:[e(T,{title:"\u590D\u5236\u94FE\u63A5",children:e(M.CopyToClipboard,{text:window.location.href,onCopy:()=>{U.success("\u590D\u5236\u6210\u529F!")},children:e(x,{symbol:"icon-share"})})}),e(T,{title:"\u8FD4\u56DE\u8BFE\u7A0B",children:e(x,{symbol:"icon-fanhui",onClick:()=>p(`/${t}`)})})]})]}),e("div",{className:"video-replay-content",children:e(z,{replay:a})})]})};export{Q as default};
